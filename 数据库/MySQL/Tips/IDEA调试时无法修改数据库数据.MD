# IDEA调试模式下，单步执行某修改方法后，数据库内容没有更新，同时也无法手动修改对应数据

    IDEA、调试模式、单步执行、springboot、mybatis、mapper、MySQL、事务、锁

本想记下完整的技术栈原因，奈何涉及的东西有点多，管不了那么多了，只能先把现象先记录下来，假定一下原因，深层原因只能等有机会的时候再写了。

一定要**戒除完美主义**，对就算出事故但影响范围也不会很大不很重要的东西，万不可追求0失误，成本太高。

## 背景

* 技术框架：springboot、mybatis、MySQL5.6、idea2023
* 业务场景：不好细说，对业务系统中的一条信息做一项操作，操作的结果是改变这条信息的若干状态。此次调试的目的是观察代码运行时数据库的改变（大概吧，有点久远记不清了）。

## 问题描述

    以下过程依次执行，但并不是一次性发现了这些现象

1. 记录有问题的请求数据，用idea打开表，筛选到目标数据。
2. IDEA调试模式运行，在某行修改数据的代码打了一个断点，发请求进入断点。
3. 鼠标滑动选中 改数据代码，```alt```+```f8```打开表达式计算器。
4. 找到刚才筛选的数据，手动修改一下，发现修改成功。
5. 在计算器中运行一下修改数据的代码。
6. 刷新筛选的数据，发现数据没有变化，但是尝试手动修改数据时，发现修改内容无法提交到数据库。
7. 点击debug窗口的绿色三角继续运行按钮，或按```f9```，跳过本次调试。
8. 再次刷新筛选的数据，发现数据更新了。
9. 手动修改，发现可以修改成功。

## 分析

估计是MySQL锁在这捣鬼，查来查去东西有点深有点多，先简单记录一下。

反复执行调试过程，不难发现是在执行修改代码后，才会出现各种稀奇的现象。
猜测是为保证事务完整性，修改数据后给数据库加了锁。
而这个锁，由于[MySQL的事务隔离级别默认是可重复读](../事务/事务的特性和隔离级别.MD#可重复读repeatable-read)，所以用的是行级锁。
调试时尝试修改别行数据，发现确实可以修改。

## 解决方案

其实算不上解决，调试过程中，注意三点：

* 注意断点前后及调试过程中执行的修改语句，在修改前可手动操作，也可查看到实际数据。
* 断点运行到修改语句后，或用计算器修改了数据后，不要查看数据库数据，这已经不是运行过程中的实际数据了。
* 手动点击继续运行按钮或本轮调试完成后，才可以查看到实际运行后的数据结果，方可进行后续操作（修改、后续处理过程）。

[//]: # (todo 如果在调试过程中，就想查看当前代码修改数据库的实际结果，应该怎么办？)
